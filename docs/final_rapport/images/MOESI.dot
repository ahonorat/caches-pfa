digraph coherence {

    node
        [shape=Mrecord width=1.5];

    subgraph cluster_MOESI {

        label="MOESI";

        //
        // States (Nodes)
        //

        "MOESI::I"
            [label="{I}"];

        "MOESI::M"
            [label="{M}"];

        "MOESI::S"
            [label="{S}"];

        "MOESI::E"
            [label="{E}"];

        "MOESI::O"
            [label="{O}"];

        //
        // Transitions (Edges)
        //

        "MOESI::I" -> "MOESI::S"
            [label="i_read()\l\[is_in_level(n,i,I) != 0\]/\lshare_line(l);\lup_stat(n, i, COHERENCE_BROADCAST);\l"];

        "MOESI::I" -> "MOESI::E"
            [label="i_read()\l\[is_in_level(n,i,I) == 0\]/\lexclusive_line(l);\lup_stat(n, i, COHERENCE_BROADCAST);\l"];

        "MOESI::I" -> "MOESI::O"
            [label="i_modify()\l\[is_in_level(n,i,I) != 0\]/\lowned_line(l);\ldirty_line(l, 1);\lup_stat(n, i, COHERENCE_BROADCAST);\l"];

        "MOESI::I" -> "MOESI::M"
            [label="i_modify()\l\[is_in_level(n,i,I) == 0\]/\lmodify_line(l);\lup_stat(n, i, COHERENCE_BROADCAST);\l"];

        "MOESI::M" -> "MOESI::O"
            [label="a_read()/\lowned_line(l);\l"];

        "MOESI::M" -> "MOESI::I"
            [label="i_del()/\linvalid_line(l);\lup_stat(n, i, WRITE_BACK);\l"];

        "MOESI::M" -> "MOESI::S"
            [label="a_modify()/\lshare_line(l);\l"];

        "MOESI::S" -> "MOESI::O"
            [label="i_modify()/\lowned_line(l);\ldirty_line(l, 1);\lup_stat(n, i, COHERENCE_BROADCAST);\l"];

        "MOESI::S" -> "MOESI::O"
            [label="a_del()\l\[is_in_level(n,i,I) != 0 && is_dirty(l) == 1 && is_in_level(n,i,O) == 0\]/\lowned_line(l);\l"];

        "MOESI::S" -> "MOESI::M"
            [label="a_del()\l\[is_in_level(n,i,I) == 0 && is_dirty(l) == 1\]/\lmodify_line(l);\l"];

        "MOESI::S" -> "MOESI::E"
            [label="a_del()\l\[is_in_level(n,i,I) == 0 && is_dirty(l) == 0\]/\lexclusive_line(l);\l"];

        "MOESI::E" -> "MOESI::S"
            [label="a_read()/\lshare_line(l);\l"];

        "MOESI::E" -> "MOESI::M"
            [label="i_modify()/\lmodify_line(l);\l"];

        "MOESI::E" -> "MOESI::I"
            [label="i_del()/\linvalid_line(l);\l"];

        "MOESI::E" -> "MOESI::S"
            [label="a_modify()/\lshare_line(l);\ldirty_line(l, 1);\l"];

        "MOESI::O" -> "MOESI::I"
            [label="i_del()/\linvalid_line(l);\lup_stat(n, i, COHERENCE_BROADCAST);\l"];

        "MOESI::O" -> "MOESI::S"
            [label="a_modify()/\lshare_line(l);\l"];

        "MOESI::O" -> "MOESI::M"
            [label="a_del()\l\[is_in_level(n,i,I) == 0\]/\lmodify_line(l);\l"];
    }

}
